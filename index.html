<!DOCTYPE html>
<html>
  <head>
    <style>
      html, head { width: 100%; height: 100%; overflow: hidden; }
    </style>
  </head>
  <body>
    <canvas id="lienzo"></canvas>
    <script>
      class Nave {
        constructor(color) {
          this.posx = Math.random() * window.innerWidth;
          this.posy = Math.random() * window.innerHeight;
          this.rot = Math.random() * Math.PI * 2;
          this.color = color;
          this.velocityX = 0;
          this.velocityY = 0;
          this.angularVelocity = 0;
          this.acceleration = 0.1;
          this.angularAcceleration = 0.01;
          this.proyectiles = [];
          this.lastProjectileTime = 0;
        }
        dibuja() {
          contexto.save();
          contexto.translate(this.posx, this.posy);
          this.rot += this.angularVelocity;

          // Wrap around on the X-axis
          if (this.posx < 0) {
            this.posx = window.innerWidth;
          } else if (this.posx > window.innerWidth) {
            this.posx = 0;
          }

          // Wrap around on the Y-axis
          if (this.posy < 0) {
            this.posy = window.innerHeight;
          } else if (this.posy > window.innerHeight) {
            this.posy = 0;
          }

          this.posx += this.velocityX;
          this.posy += this.velocityY;
          contexto.rotate(this.rot);
          contexto.fillStyle = this.color;
          contexto.beginPath();

          const x1 = 0;
          const y1 = -10;
          const x2 = -5;
          const y2 = 5;
          const x3 = 5;
          const y3 = 5;

          contexto.moveTo(x1, y1);
          contexto.lineTo(x2, y2);
          contexto.lineTo(x3, y3);
          contexto.closePath();
          contexto.fill();
          contexto.fillStyle = "white";
          contexto.beginPath();
          contexto.arc(0, 0, 2, 0, Math.PI * 2, true);
          contexto.closePath();
          contexto.fill();

          contexto.restore();
        }
        avanza() {
          this.velocityX += Math.cos(this.rot - Math.PI / 2) * this.acceleration / 5;
          this.velocityY += Math.sin(this.rot - Math.PI / 2) * this.acceleration / 5;
        }
        gira(direction) {
          this.angularVelocity += direction * this.angularAcceleration / 20;
        }
        applyInertia() {
          this.velocityX *= 0.99;
          this.velocityY *= 0.99;
          this.angularVelocity *= 0.99;
        }
        dibujaProyectiles() {
          for (let i = this.proyectiles.length - 1; i >= 0; i--) {
            const proyectil = this.proyectiles[i];
            proyectil.move();
            proyectil.dibuja();

            // Remove projectiles that go out of the canvas
            if (
              proyectil.posx < 0 ||
              proyectil.posx > window.innerWidth ||
              proyectil.posy < 0 ||
              proyectil.posy > window.innerHeight
            ) {
              this.proyectiles.splice(i, 1);
            }
          }
        }
        fireProjectile() {
          const currentTime = Date.now();
          if (currentTime - this.lastProjectileTime >= 1000) {
            const velocityX = Math.cos(this.rot - Math.PI / 2);
            const velocityY = Math.sin(this.rot - Math.PI / 2);
            this.proyectiles.push(new Proyectil(this.posx, this.posy, this.rot, velocityX, velocityY, this.color));
            this.lastProjectileTime = currentTime;
          }
        }
      }

      class Proyectil {
        constructor(x, y, angle, velocityX, velocityY, color) {
          this.posx = x;
          this.posy = y;
          this.angle = angle;
          this.velocityX = velocityX;
          this.velocityY = velocityY;
          this.color = color;
          this.speed = 3;
        }
        move() {
          this.posx += this.velocityX * this.speed;
          this.posy += this.velocityY * this.speed;
        }
        dibuja() {
          contexto.fillStyle = this.color;
          contexto.beginPath();
          contexto.arc(this.posx, this.posy, 2, 0, Math.PI * 2, true);
          contexto.closePath();
          contexto.fill();
        }
      }

      const lienzo = document.getElementById("lienzo");
      const contexto = lienzo.getContext("2d");
      lienzo.width = window.innerWidth;
      lienzo.height = window.innerHeight;
      const jugador1 = new Nave("red");
      const jugador2 = new Nave("blue");
      jugador1.dibuja();
      jugador2.dibuja();

      var gira1 = 0;
      var avanza1 = false;
      var disparar1 = false;
      var gira2 = 0;
      var avanza2 = false;
      var disparar2 = false;

      window.onload = function () {
        window.addEventListener("keydown", onKeyDown);
        window.addEventListener("keyup", onKeyUp);

        let temporizador = setTimeout(bucle, 10);

        function onKeyDown(e) {
          if (e.key === "a") {
            gira1 = -1;
          } else if (e.key === "d") {
            gira1 = 1;
          } else if (e.key === "w") {
            avanza1 = true;
          } else if (e.keyCode === 32) {
            disparar1 = true;
          } else if (e.key === "ArrowLeft" || e.key === "ArrowRight") {
            gira2 = (e.key === "ArrowLeft") ? -1 : 1;
          } else if (e.key === "ArrowUp") {
            avanza2 = true;
          } else if (e.keyCode === 189) {
            disparar2 = true;
          }
        }

        function onKeyUp(e) {
          if (e.key === "a" || e.key === "d") {
            gira1 = 0;
          } else if (e.key === "w") {
            avanza1 = false;
          } else if (e.keyCode === 32) {
            disparar1 = false;
          } else if (e.key === "ArrowLeft" || e.key === "ArrowRight") {
            gira2 = 0;
          } else if (e.key === "ArrowUp") {
            avanza2 = false;
          } else if (e.keyCode === 189) {
            disparar2 = false;
          }
        }

        function bucle() {
          jugador1.gira(gira1);
          if (avanza1) {
            jugador1.avanza();
          }
          jugador1.applyInertia();

          jugador2.gira(gira2);
          if (avanza2) {
            jugador2.avanza();
          }
          jugador2.applyInertia();

          contexto.clearRect(0, 0, window.innerWidth, window.innerHeight);
          jugador1.dibuja();
          jugador2.dibuja();

          if (disparar1) {
            jugador1.fireProjectile();
          }

          if (disparar2) {
            jugador2.fireProjectile();
          }

          checkCollisions(jugador1, jugador2);

          jugador1.dibujaProyectiles();
          jugador2.dibujaProyectiles();

          clearTimeout(temporizador);
          temporizador = setTimeout(bucle, 10);
        }

        function checkCollisions(player1, player2) {
          for (let i = player1.proyectiles.length - 1; i >= 0; i--) {
            const proyectil = player1.proyectiles[i];
            const dx = proyectil.posx - player2.posx;
            const dy = proyectil.posy - player2.posy;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 10) {
              player1.proyectiles.splice(i, 1);
              window.location.reload();
            }
          }

          for (let i = player2.proyectiles.length - 1; i >= 0; i--) {
            const proyectil = player2.proyectiles[i];
            const dx = proyectil.posx - player1.posx;
            const dy = proyectil.posy - player1.posy;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 10) {
              player2.proyectiles.splice(i, 1);
              window.location.reload();
            }
          }
        }
      };
    </script>
  </body>
</html>
