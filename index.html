<!DOCTYPE html>
<html>
  <head>
    <style>
      html, head { width: 100%; height: 100%; overflow: hidden; }
    </style>
  </head>
  <body>
    <canvas id="lienzo"></canvas>
    <script>
      class Nave {
        constructor() {
          this.posx = Math.random() * window.innerWidth;
          this.posy = Math.random() * window.innerHeight;
          this.rot = Math.random() * Math.PI * 2;
          this.color = "red";
          this.velocityX = 0;
          this.velocityY = 0;
          this.angularVelocity = 0;
          this.acceleration = 0.1;
          this.angularAcceleration = 0.01;
        }
        dibuja() {
          contexto.save();
          contexto.translate(this.posx, this.posy);
          this.rot += this.angularVelocity;
          this.posx += this.velocityX;
          this.posy += this.velocityY;
          contexto.rotate(this.rot);
          contexto.fillStyle = this.color;
          contexto.beginPath();

          const x1 = 0;
          const y1 = -10;
          const x2 = -5;
          const y2 = 5;
          const x3 = 5;
          const y3 = 5;

          contexto.moveTo(x1, y1);
          contexto.lineTo(x2, y2);
          contexto.lineTo(x3, y3);
          contexto.closePath();
          contexto.fill();
          contexto.fillStyle = "white";
          contexto.beginPath();
          contexto.arc(0, 0, 2, 0, Math.PI * 2, true);
          contexto.closePath();
          contexto.fill();

          contexto.restore();
        }
        avanza() {
          this.velocityX += Math.cos(this.rot - Math.PI / 2) * this.acceleration/5;
          this.velocityY += Math.sin(this.rot - Math.PI / 2) * this.acceleration/5;
        }
        gira(direction) {
          this.angularVelocity += direction * this.angularAcceleration/20;
        }
        applyInertia() {
          this.velocityX *= 0.99;
          this.velocityY *= 0.99;
          this.angularVelocity *= 0.99;
        }
      }
        
    class Proyectil {
        constructor(x, y, angle, velocityX, velocityY) {
          this.posx = x;
          this.posy = y;
          this.angle = angle;
          this.velocityX = velocityX;
          this.velocityY = velocityY;
          this.color = "blue"; // Color of the projectiles
          this.speed = 3; // Speed of the projectiles
        }
        move() {
          this.posx += this.velocityX * this.speed;
          this.posy += this.velocityY * this.speed;
        }
        dibuja() {
          contexto.fillStyle = this.color;
          contexto.beginPath();
          contexto.arc(this.posx, this.posy, 2, 0, Math.PI * 2, true);
          contexto.closePath();
          contexto.fill();
        }
      }
        
        
      const lienzo = document.getElementById("lienzo");
      const contexto = lienzo.getContext("2d");
      lienzo.width = window.innerWidth;
      lienzo.height = window.innerHeight;
      const jugador = new Nave();
      jugador.dibuja();

      var gira = 0;
      var avanza = false;
        var disparar = false;
      const proyectiles = [];

      window.onkeydown = function (e) {
        if (e.key === "a") {
          gira = -1;
        } else if (e.key === "d") {
          gira = 1;
        } else if (e.key === "w") {
          avanza = true;
        }else if (e.key === " ") {
          disparar = true; // Space key to shoot projectiles
        }
      };

      window.onkeyup = function (e) {
        if (e.key === "a" || e.key === "d") {
          gira = 0;
        } else if (e.key === "w") {
          avanza = false;
        }else if (e.key === " ") {
          disparar = false;
        }
      };

      let temporizador = setTimeout(bucle, 10);

      function bucle() {
        jugador.gira(gira);
        if (avanza) {
          jugador.avanza();
        }
        jugador.applyInertia();

        contexto.clearRect(0, 0, window.innerWidth, window.innerHeight);
        jugador.dibuja();
          
          if (disparar) {
          // Calculate the velocity of the projectile based on ship's angle
          const velocityX = Math.cos(jugador.rot - Math.PI / 2);
          const velocityY = Math.sin(jugador.rot - Math.PI / 2);

          // Create a new projectile and add it to the array
          proyectiles.push(new Proyectil(jugador.posx, jugador.posy, jugador.rot, velocityX, velocityY));
        }

        // Move and draw the projectiles
        for (let i = proyectiles.length - 1; i >= 0; i--) {
          proyectiles[i].move();
          proyectiles[i].dibuja();
          
          // Remove projectiles that go out of the canvas
          if (
            proyectiles[i].posx < 0 ||
            proyectiles[i].posx > window.innerWidth ||
            proyectiles[i].posy < 0 ||
            proyectiles[i].posy > window.innerHeight
          ) {
            proyectiles.splice(i, 1);
          }
        }

        clearTimeout(temporizador);
        temporizador = setTimeout(bucle, 10);
      }
    </script>
  </body>
</html>
